{"version":3,"file":"Disposables.js","names":["Disposables","Array","constructor","index","groups","add","disposable","push","findIndex","item","splice","dispose","groupValues","Object","values","group","TypeError","name","Reflect","deleteProperty"],"sources":["../src/Disposables.ts"],"sourcesContent":["/**\r\n * Allow to memorize some revertable actions\r\n */\r\nimport { IDisposable } from \"./types.d\";\r\n\r\nexport default class Disposables extends Array {\r\n  private groups: {\r\n    [name: string]: Disposables;\r\n  };\r\n  constructor(index: number = 0) {\r\n    super(index);\r\n\r\n    this.groups = {};\r\n  }\r\n  public add(disposable: IDisposable) {\r\n\r\n    this.push(disposable);\r\n\r\n    return () => {\r\n      const index = this.findIndex((item) => item === disposable);\r\n\r\n      if (index > -1) {\r\n        this.splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  /** Dispose specified name or all disposable objects */\r\n  public dispose() {\r\n    /* Dispose groups */\r\n    const groupValues = Object.values(this.groups);\r\n    for (const group of groupValues) {\r\n      group.dispose();\r\n    }\r\n\r\n    /* Dispose own disposable */\r\n    for (const disposable of this) {\r\n      if (typeof disposable === \"function\") {\r\n        disposable();\r\n      } else if (typeof disposable === \"object\" && typeof disposable.dispose === \"function\") {\r\n        disposable.dispose(this);\r\n      } else {\r\n        throw new TypeError(\"Invald disposable object\");\r\n      }\r\n    }\r\n  }\r\n\r\n  public group(name: string) {\r\n    if (!this.groups[name]) {\r\n      this.groups[name] = new Disposables();\r\n      this.groups[name].add(() => {\r\n        Reflect.deleteProperty(this.groups, name);\r\n      });\r\n    }\r\n\r\n    return this.groups[name];\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;AAKe,MAAMA,WAAW,SAASC,KAAK,CAAC;EAI7CC,WAAW,CAACC,KAAa,GAAG,CAAC,EAAE;IAC7B,KAAK,CAACA,KAAK,CAAC;IAAC;IAEb,IAAI,CAACC,MAAM,GAAG,CAAC,CAAC;EAClB;EACOC,GAAG,CAACC,UAAuB,EAAE;IAElC,IAAI,CAACC,IAAI,CAACD,UAAU,CAAC;IAErB,OAAO,MAAM;MACX,MAAMH,KAAK,GAAG,IAAI,CAACK,SAAS,CAAEC,IAAI,IAAKA,IAAI,KAAKH,UAAU,CAAC;MAE3D,IAAIH,KAAK,GAAG,CAAC,CAAC,EAAE;QACd,IAAI,CAACO,MAAM,CAACP,KAAK,EAAE,CAAC,CAAC;MACvB;IACF,CAAC;EACH;EAGOQ,OAAO,GAAG;IAEf,MAAMC,WAAW,GAAGC,MAAM,CAACC,MAAM,CAAC,IAAI,CAACV,MAAM,CAAC;IAC9C,KAAK,MAAMW,KAAK,IAAIH,WAAW,EAAE;MAC/BG,KAAK,CAACJ,OAAO,EAAE;IACjB;IAGA,KAAK,MAAML,UAAU,IAAI,IAAI,EAAE;MAC7B,IAAI,OAAOA,UAAU,KAAK,UAAU,EAAE;QACpCA,UAAU,EAAE;MACd,CAAC,MAAM,IAAI,OAAOA,UAAU,KAAK,QAAQ,IAAI,OAAOA,UAAU,CAACK,OAAO,KAAK,UAAU,EAAE;QACrFL,UAAU,CAACK,OAAO,CAAC,IAAI,CAAC;MAC1B,CAAC,MAAM;QACL,MAAM,IAAIK,SAAS,CAAC,0BAA0B,CAAC;MACjD;IACF;EACF;EAEOD,KAAK,CAACE,IAAY,EAAE;IACzB,IAAI,CAAC,IAAI,CAACb,MAAM,CAACa,IAAI,CAAC,EAAE;MACtB,IAAI,CAACb,MAAM,CAACa,IAAI,CAAC,GAAG,IAAIjB,WAAW,EAAE;MACrC,IAAI,CAACI,MAAM,CAACa,IAAI,CAAC,CAACZ,GAAG,CAAC,MAAM;QAC1Ba,OAAO,CAACC,cAAc,CAAC,IAAI,CAACf,MAAM,EAAEa,IAAI,CAAC;MAC3C,CAAC,CAAC;IACJ;IAEA,OAAO,IAAI,CAACb,MAAM,CAACa,IAAI,CAAC;EAC1B;AACF;AAAC"}