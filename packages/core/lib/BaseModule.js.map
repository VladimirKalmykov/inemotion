{"version":3,"file":"BaseModule.js","names":["BaseModule","Serializable","constructor","disposables","Disposables","hooks","hookTypes","Object","getPrototypeOf","length","registerHookTypes","hookName","Error","addHook","hookType","hook","TypeError","push","removeHook","hookToRemove","index","findIndex","splice","triggerHooks","args","Reflect","apply","destroy","dispose","onDestroy"],"sources":["../src/BaseModule.ts"],"sourcesContent":["import { FunctionType, THook, IDisposable, IBaseModule } from \"./types.d\";\r\nimport Disposables from \"./Disposables\";\r\nimport Serializable from \"./Serializable\";\r\n\r\nexport default abstract class BaseModule extends Serializable implements IBaseModule {\r\n  protected disposables: Disposables;\r\n  private hooks: {\r\n    [hookType: string]: THook[];\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    this.disposables = new Disposables();\r\n    this.hooks = {};\r\n\r\n    /* Define hook types */\r\n    const hookTypes = Object.getPrototypeOf(this).constructor.hookTypes || [];\r\n    if (hookTypes.length > 0) {\r\n      this.registerHookTypes(hookTypes);\r\n    }\r\n  }\r\n\r\n  public registerHookTypes(hookTypes: string[]) {\r\n    for (const hookName of hookTypes) {\r\n      if (this.hooks[hookName]) {\r\n        throw new Error(`Hook \"${hookName}\" already exists`);\r\n      }\r\n      this.hooks[hookName] = [];\r\n    }\r\n  }\r\n\r\n  public addHook(hookType: string, hook: THook): IDisposable {\r\n    if (!this.hooks[hookType]) {\r\n      throw new TypeError(`Unknown hook type \"${hookType}\"`);\r\n    }\r\n\r\n    this.hooks[hookType].push(hook);\r\n\r\n    return () => this.removeHook(hookType, hook);\r\n  }\r\n\r\n  public removeHook(hookType: string, hookToRemove: THook) {\r\n    if (!this.hooks[hookType]) {\r\n      throw new TypeError(`Unknown hook type \"${hookType}\"`);\r\n    }\r\n\r\n    const index = this.hooks[hookType].findIndex((hook: FunctionType) => hook === hookToRemove);\r\n    if (index > -1) {\r\n      this.hooks[hookType].splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public triggerHooks(hookType: string, args: any[] = []) {\r\n    if (!this.hooks[hookType]) {\r\n      throw new TypeError(`Unknown hook type \"${hookType}\"`);\r\n    }\r\n\r\n    for (const hook of this.hooks[hookType]) {\r\n      Reflect.apply(hook, this, args);\r\n    }\r\n  }\r\n\r\n  public destroy() {\r\n    this.disposables.dispose();\r\n\r\n    if (typeof this.onDestroy === \"function\") {\r\n      this.onDestroy();\r\n    }\r\n  }\r\n\r\n  protected dispose(): void {\r\n    this.dispose();\r\n  }\r\n\r\n  protected onDestroy(): void {}\r\n}\r\n"],"mappings":";;;;;;AACA;AACA;AAA0C;AAAA;AAAA;AAAA;AAE3B,MAAeA,UAAU,SAASC,qBAAY,CAAwB;EAMnFC,WAAW,GAAG;IACZ,KAAK,EAAE;IAAC;IAAA;IACR,IAAI,CAACC,WAAW,GAAG,IAAIC,oBAAW,EAAE;IACpC,IAAI,CAACC,KAAK,GAAG,CAAC,CAAC;IAGf,MAAMC,SAAS,GAAGC,MAAM,CAACC,cAAc,CAAC,IAAI,CAAC,CAACN,WAAW,CAACI,SAAS,IAAI,EAAE;IACzE,IAAIA,SAAS,CAACG,MAAM,GAAG,CAAC,EAAE;MACxB,IAAI,CAACC,iBAAiB,CAACJ,SAAS,CAAC;IACnC;EACF;EAEOI,iBAAiB,CAACJ,SAAmB,EAAE;IAC5C,KAAK,MAAMK,QAAQ,IAAIL,SAAS,EAAE;MAChC,IAAI,IAAI,CAACD,KAAK,CAACM,QAAQ,CAAC,EAAE;QACxB,MAAM,IAAIC,KAAK,CAAE,SAAQD,QAAS,kBAAiB,CAAC;MACtD;MACA,IAAI,CAACN,KAAK,CAACM,QAAQ,CAAC,GAAG,EAAE;IAC3B;EACF;EAEOE,OAAO,CAACC,QAAgB,EAAEC,IAAW,EAAe;IACzD,IAAI,CAAC,IAAI,CAACV,KAAK,CAACS,QAAQ,CAAC,EAAE;MACzB,MAAM,IAAIE,SAAS,CAAE,sBAAqBF,QAAS,GAAE,CAAC;IACxD;IAEA,IAAI,CAACT,KAAK,CAACS,QAAQ,CAAC,CAACG,IAAI,CAACF,IAAI,CAAC;IAE/B,OAAO,MAAM,IAAI,CAACG,UAAU,CAACJ,QAAQ,EAAEC,IAAI,CAAC;EAC9C;EAEOG,UAAU,CAACJ,QAAgB,EAAEK,YAAmB,EAAE;IACvD,IAAI,CAAC,IAAI,CAACd,KAAK,CAACS,QAAQ,CAAC,EAAE;MACzB,MAAM,IAAIE,SAAS,CAAE,sBAAqBF,QAAS,GAAE,CAAC;IACxD;IAEA,MAAMM,KAAK,GAAG,IAAI,CAACf,KAAK,CAACS,QAAQ,CAAC,CAACO,SAAS,CAAEN,IAAkB,IAAKA,IAAI,KAAKI,YAAY,CAAC;IAC3F,IAAIC,KAAK,GAAG,CAAC,CAAC,EAAE;MACd,IAAI,CAACf,KAAK,CAACS,QAAQ,CAAC,CAACQ,MAAM,CAACF,KAAK,EAAE,CAAC,CAAC;IACvC;EACF;EAEOG,YAAY,CAACT,QAAgB,EAAEU,IAAW,GAAG,EAAE,EAAE;IACtD,IAAI,CAAC,IAAI,CAACnB,KAAK,CAACS,QAAQ,CAAC,EAAE;MACzB,MAAM,IAAIE,SAAS,CAAE,sBAAqBF,QAAS,GAAE,CAAC;IACxD;IAEA,KAAK,MAAMC,IAAI,IAAI,IAAI,CAACV,KAAK,CAACS,QAAQ,CAAC,EAAE;MACvCW,OAAO,CAACC,KAAK,CAACX,IAAI,EAAE,IAAI,EAAES,IAAI,CAAC;IACjC;EACF;EAEOG,OAAO,GAAG;IACf,IAAI,CAACxB,WAAW,CAACyB,OAAO,EAAE;IAE1B,IAAI,OAAO,IAAI,CAACC,SAAS,KAAK,UAAU,EAAE;MACxC,IAAI,CAACA,SAAS,EAAE;IAClB;EACF;EAEUD,OAAO,GAAS;IACxB,IAAI,CAACA,OAAO,EAAE;EAChB;EAEUC,SAAS,GAAS,CAAC;AAC/B;AAAC"}