{"version":3,"file":"DistanceJoint.js","names":["getAngle","cx","cy","ex","ey","dy","dx","theta","Math","atan2","DistanceJoint","Component","constructor","gameObject","config","targetObject","Error","x1","transform","position","x","y1","y","x2","y2","dist","sqrt","pow","onFixedUpdate","lastFrameStamp","updateFrameStamp","angle","newDist","diff","nextX","cos","nextY","sin","triggerHooks","renderLines","ctx","backupStyle","strokeStyle","beginPath","moveTo","lineTo","stroke"],"sources":["../../src/components/DistanceJoint.ts"],"sourcesContent":["import { Component, IGameObject, ICanvas2DApi } from \"@inemotion/core\";\r\n\r\nfunction getAngle(cx: number, cy: number, ex: number, ey: number): number {\r\n  const dy = ey - cy;\r\n  const dx = ex - cx;\r\n  const theta = Math.atan2(dy, dx); // range (-PI, PI]\r\n  return theta;\r\n}\r\n\r\ninterface IDistanceJointConfig {\r\n  targetObject: IGameObject;\r\n}\r\n\r\nexport default class DistanceJoint extends Component {\r\n  public targetObject: IGameObject;\r\n  private dist: number;\r\n  private lastFrameStamp: number;\r\n  constructor(gameObject: IGameObject, config: IDistanceJointConfig) {\r\n    super(gameObject);\r\n    const {\r\n      targetObject,\r\n    } = config;\r\n\r\n    if (!targetObject) {\r\n      throw new Error(\"Target object requires to be provided an actual game object\");\r\n    }\r\n\r\n    this.targetObject = targetObject;\r\n\r\n    /* Calc initial distance between current gameObject and target */\r\n    const x1 = this.targetObject.transform.position.x;\r\n    const y1 = this.targetObject.transform.position.y;\r\n    const x2 = gameObject.transform.position.x;\r\n    const y2 = gameObject.transform.position.y;\r\n\r\n    this.dist = Math.sqrt(Math.pow((x1 - x2), 2) + Math.pow((y1 - y2), 2));\r\n  }\r\n\r\n  public onFixedUpdate() {\r\n    // Ignore update if it is already updated in current frame\r\n    if (this.lastFrameStamp === this.gameObject.updateFrameStamp) {\r\n      return;\r\n    }\r\n    const x1 = this.targetObject.transform.position.x;\r\n    const y1 = this.targetObject.transform.position.y;\r\n    const x2 = this.gameObject.transform.position.x;\r\n    const y2 = this.gameObject.transform.position.y;\r\n    const angle: number = getAngle(x2, y2, x1, y1);\r\n\r\n    const newDist = Math.sqrt(Math.pow((x1 - x2), 2) + Math.pow((y1 - y2), 2));\r\n\r\n    const diff = (newDist - this.dist);\r\n    const nextX = x2 + diff * Math.cos(angle);\r\n    const nextY = y2 + diff * Math.sin(angle);\r\n\r\n    this.gameObject.transform.position.x = nextX;\r\n    this.gameObject.transform.position.y = nextY;\r\n\r\n    this.lastFrameStamp = this.gameObject.updateFrameStamp;\r\n\r\n    this.gameObject.triggerHooks(\"updated\");\r\n  }\r\n\r\n  private renderLines(ctx: ICanvas2DApi) {\r\n    const x1 = this.targetObject.transform.position.x;\r\n    const y1 = this.targetObject.transform.position.y;\r\n    const x2 = this.gameObject.transform.position.x;\r\n    const y2 = this.gameObject.transform.position.y;\r\n\r\n    const backupStyle = ctx.strokeStyle;\r\n    ctx.strokeStyle = \"white\";\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.lineTo(x2, y2);\r\n    ctx.stroke();\r\n\r\n    // Repair fill style\r\n    ctx.strokeStyle = backupStyle;\r\n  }\r\n}\r\n"],"mappings":";;;;;;AAAA;AAAuE;AAAA;AAAA;AAEvE,SAASA,QAAQ,CAACC,EAAU,EAAEC,EAAU,EAAEC,EAAU,EAAEC,EAAU,EAAU;EACxE,MAAMC,EAAE,GAAGD,EAAE,GAAGF,EAAE;EAClB,MAAMI,EAAE,GAAGH,EAAE,GAAGF,EAAE;EAClB,MAAMM,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACJ,EAAE,EAAEC,EAAE,CAAC;EAChC,OAAOC,KAAK;AACd;AAMe,MAAMG,aAAa,SAASC,eAAS,CAAC;EAInDC,WAAW,CAACC,UAAuB,EAAEC,MAA4B,EAAE;IACjE,KAAK,CAACD,UAAU,CAAC;IAAC;IAAA;IAAA;IAClB,MAAM;MACJE;IACF,CAAC,GAAGD,MAAM;IAEV,IAAI,CAACC,YAAY,EAAE;MACjB,MAAM,IAAIC,KAAK,CAAC,6DAA6D,CAAC;IAChF;IAEA,IAAI,CAACD,YAAY,GAAGA,YAAY;IAGhC,MAAME,EAAE,GAAG,IAAI,CAACF,YAAY,CAACG,SAAS,CAACC,QAAQ,CAACC,CAAC;IACjD,MAAMC,EAAE,GAAG,IAAI,CAACN,YAAY,CAACG,SAAS,CAACC,QAAQ,CAACG,CAAC;IACjD,MAAMC,EAAE,GAAGV,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACC,CAAC;IAC1C,MAAMI,EAAE,GAAGX,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACG,CAAC;IAE1C,IAAI,CAACG,IAAI,GAAGjB,IAAI,CAACkB,IAAI,CAAClB,IAAI,CAACmB,GAAG,CAAEV,EAAE,GAAGM,EAAE,EAAG,CAAC,CAAC,GAAGf,IAAI,CAACmB,GAAG,CAAEN,EAAE,GAAGG,EAAE,EAAG,CAAC,CAAC,CAAC;EACxE;EAEOI,aAAa,GAAG;IAErB,IAAI,IAAI,CAACC,cAAc,KAAK,IAAI,CAAChB,UAAU,CAACiB,gBAAgB,EAAE;MAC5D;IACF;IACA,MAAMb,EAAE,GAAG,IAAI,CAACF,YAAY,CAACG,SAAS,CAACC,QAAQ,CAACC,CAAC;IACjD,MAAMC,EAAE,GAAG,IAAI,CAACN,YAAY,CAACG,SAAS,CAACC,QAAQ,CAACG,CAAC;IACjD,MAAMC,EAAE,GAAG,IAAI,CAACV,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACC,CAAC;IAC/C,MAAMI,EAAE,GAAG,IAAI,CAACX,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACG,CAAC;IAC/C,MAAMS,KAAa,GAAG/B,QAAQ,CAACuB,EAAE,EAAEC,EAAE,EAAEP,EAAE,EAAEI,EAAE,CAAC;IAE9C,MAAMW,OAAO,GAAGxB,IAAI,CAACkB,IAAI,CAAClB,IAAI,CAACmB,GAAG,CAAEV,EAAE,GAAGM,EAAE,EAAG,CAAC,CAAC,GAAGf,IAAI,CAACmB,GAAG,CAAEN,EAAE,GAAGG,EAAE,EAAG,CAAC,CAAC,CAAC;IAE1E,MAAMS,IAAI,GAAID,OAAO,GAAG,IAAI,CAACP,IAAK;IAClC,MAAMS,KAAK,GAAGX,EAAE,GAAGU,IAAI,GAAGzB,IAAI,CAAC2B,GAAG,CAACJ,KAAK,CAAC;IACzC,MAAMK,KAAK,GAAGZ,EAAE,GAAGS,IAAI,GAAGzB,IAAI,CAAC6B,GAAG,CAACN,KAAK,CAAC;IAEzC,IAAI,CAAClB,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACC,CAAC,GAAGc,KAAK;IAC5C,IAAI,CAACrB,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACG,CAAC,GAAGc,KAAK;IAE5C,IAAI,CAACP,cAAc,GAAG,IAAI,CAAChB,UAAU,CAACiB,gBAAgB;IAEtD,IAAI,CAACjB,UAAU,CAACyB,YAAY,CAAC,SAAS,CAAC;EACzC;EAEQC,WAAW,CAACC,GAAiB,EAAE;IACrC,MAAMvB,EAAE,GAAG,IAAI,CAACF,YAAY,CAACG,SAAS,CAACC,QAAQ,CAACC,CAAC;IACjD,MAAMC,EAAE,GAAG,IAAI,CAACN,YAAY,CAACG,SAAS,CAACC,QAAQ,CAACG,CAAC;IACjD,MAAMC,EAAE,GAAG,IAAI,CAACV,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACC,CAAC;IAC/C,MAAMI,EAAE,GAAG,IAAI,CAACX,UAAU,CAACK,SAAS,CAACC,QAAQ,CAACG,CAAC;IAE/C,MAAMmB,WAAW,GAAGD,GAAG,CAACE,WAAW;IACnCF,GAAG,CAACE,WAAW,GAAG,OAAO;IAEzBF,GAAG,CAACG,SAAS,EAAE;IACfH,GAAG,CAACI,MAAM,CAAC3B,EAAE,EAAEI,EAAE,CAAC;IAClBmB,GAAG,CAACK,MAAM,CAACtB,EAAE,EAAEC,EAAE,CAAC;IAClBgB,GAAG,CAACM,MAAM,EAAE;IAGZN,GAAG,CAACE,WAAW,GAAGD,WAAW;EAC/B;AACF;AAAC"}